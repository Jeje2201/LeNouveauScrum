<body class="fixed-nav sticky-footer" id="page-Result">
  <div class="content-wrapper">
    <div class="container-fluid">

      <div class="row">
        <div class="col-lg-6">
          <!-- Example Bar Chart Card-->
          <div class="card mb-3">
            <div class="card-header">
              Trier Sprint/Ressource
            </div>
            <div class="card-body">
              <!-- Selectionner le sprint sur lequel l'on va jouer -->

              <div class="input-group mb-12">
                <div class="input-group-prepend">
                  <span class="input-group-text">Sprint n°</span>
                </div>

                <div id="ListSrint"></div>
                <div class="input-group-prepend">
                  <span class="input-group-text">Ressource</span>
                </div>
                <div id="ListeEmploye"></div>

              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <!-- Example Pie Chart Card-->
          <div class="card mb-3">
            <div class="card-header">
              Valider les tâches
            </div>
            <div class="card-body">

              <div class="input-group mb-12">

                <div class="input-group-prepend">
                  <span class="input-group-text">Date</span>
                </div>
                <input type="text" name="DateAujourdhui" id='DateAujourdhui' class="form-control" />

                <button type="button" id="Descendre" class="btn btn-info">
                  <i class="fa fa-check" aria-hidden="true"></i>&nbsp;Descendre</button>

              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="row">
        <div class="col-lg-6">
          <div class="card">
            <div class="card-header" style="text-align: center">
              Tâches en cours
            </div>
            <div class="card-body card-columns" id=EnCours>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="card">
            <div class="card-header" style="text-align: center">
              Tâches achevées
            </div>
            <div class="card-body card-columns" id=Fini>
            </div>
          </div>

        </div>
      </div>
    </div>
</body>
<script>

  $(document).ready(function () {

    $('#DateAujourdhui').datetimepicker({
      format: 'dd-mm-yyyy',
      autoclose: true,
      minView: 2
    });

    RequeteAjax('ListSrint', 'ListeDeroulanteSprint', 'Modele/RequetesAjax.php');
    RemplirListeEmploye();
    AfficherCards();

    function AfficherCards() {
      $.ajax({
        url: "Modele/Tache.php",
        method: "POST",
        data: {
          action: "AfficherCards",
          idAffiche: $('#numeroSprint').val(),
          idEmploye: $('#numeroEmploye').val()
        },
        success: function (data) {
          $('#EnCours').html(data.Attribution);
          $('#Fini').html(data.Descendue);

          $.ajax({
            url: "Modele/Tache.php",
            method: "POST",
            data: {
              action: "DateMinMax",
              idAffiche: $('#numeroSprint').val()
            },
            success: function (data) {
              $('#DateAujourdhui').datetimepicker('setStartDate', data['DateMin']);
              $('#DateAujourdhui').datetimepicker('setEndDate', data['DateMax']);

              if (DateFrToEn(ChoixDate(0)) >= DateFrToEn(String(data['DateMin'])) && DateFrToEn(ChoixDate(0)) <= DateFrToEn(String(data['DateMax']))) {
                $('#DateAujourdhui').val(ChoixDate(0));
              }
              else {
                $('#DateAujourdhui').val(data['DateMax']);
              }
              $(function () {
                $('[data-toggle="tooltip"]').tooltip()
              })
            }
          });
        }
      });
    }

    function RemplirListeEmploye() {
      $.ajax({
        url: "Modele/Tache.php",
        method: "POST",
        async: false,
        data: {
          action: "LoadListEmployes",
          idAffiche: $('#numeroSprint').val()
        },
        success: function (data) {
          $('#ListeEmploye').html(data.Attribution);
          var NumEmploye = localStorage.getItem("Connexion")
          $('#numeroEmploye option[value="' + NumEmploye + '"]').attr('selected', 'selected');
        }
      });

    }

    $('#numeroSprint').change(function () {
      RemplirListeEmploye();
      AfficherCards();
    });

    $('#ListeEmploye').change(function () {
      AfficherCards();
    });

    $('#Descendre').click(function () {
      var IdAttribue = [];

      $('#Fini').find(".BOUGEMOI").each(function () {
        IdAttribue.push($(this).attr('id'));
      });

      if (IdAttribue != '') {
        $.ajax({
          url: "Modele/Tache.php",
          method: "POST",
          data: {
            IdAttribue: IdAttribue,
            action: "Descendre",
            LeJourDeDescente: DateFrToEn($('#DateAujourdhui').val())
          },
          success: function (data) {
            BootstrapAlertDefaut(data);
            AfficherCards();
          }
        });
      }
      else {
        BootstrapAlertError("Tu dois d'abord déplacer au moins une tâche de son emplacement \"en cours\" -> \"terminée.\"");
      }

    });
  });

  function DeplaceToi(id) {

    if ($(id).parent().attr('id') == 'EnCours') {
      $(id).prependTo($("#Fini"));

    }
    else {
      $(id).prependTo($("#EnCours"));
    }
  }

</script>