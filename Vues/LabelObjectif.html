<body class="fixed-nav sticky-footer" id="page-top">
  <div class="content-wrapper">
    <div class="container-fluid">

      <div class="row mb-3">
        <div class="col-lg-2">
          <div id="ListSrint" onchange="RemplirTableau();"></div>
        </div>
        <div class="col-lg-10">
          <button  class="btn btn-block btn-success" onclick="SaveAll();">Tout sauvegarder</button>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <div id="TableObjectif" class="table-responsive table-striped table-hover"></div>
        </div>
      </div>

    </div>
  </div>

<script>
  RequeteAjax('ListSrint', 'ListeDeroulanteSprint', 'Modele/RequetesAjax.php');
  RemplirTableau();

  var ListIdInputChanged = new Array

  function ListInputChanged(input) {

    var id = parseInt(input.getAttribute("id"))

    if (!ListIdInputChanged.includes(id)) {
      ListIdInputChanged.push(id)
    }
  }

  function RemplirTableau() {
    $.ajax({
      url: "Modele/Tache.php",
      method: "POST",
      data: {
        action: "Load_LabelTache",
        idSprint: $("#numeroSprint").val()
      },
      success: function (data) {
        document
          .getElementById('TableObjectif')
          .innerHTML = data;
      }
    });
  }

  function SaveAll() {

    var ToReturn = new Array();
    $("input[type=text]").each(function () {

      inputId = parseInt($(this).attr('id'))
      inputText = $(this).val().replace(/\"|\'|\`/g, "")

      if (ListIdInputChanged.includes(inputId)) {
        var UnInputChanged = new Array();
        UnInputChanged.push(inputId)
        UnInputChanged.push(inputText)
        ToReturn.push(UnInputChanged)
      }
    });

    if(ToReturn.length > 0){

    $.ajax({
      url: "Modele/Tache.php",
      method: "POST",
      data: {
        action: "Changer_LabelTache",
        ToReturn: ToReturn
      },
      success: function (data) {
        $.notify(data, "success");
        RemplirTableau();
      }
    });}
    else{
      Notify(0,"","Aucune tâche changée")
    }
  };
</script>