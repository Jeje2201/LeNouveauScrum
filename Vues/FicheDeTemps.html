<body class="fixed-nav sticky-footer" id="page-top">
  <div class="content-wrapper">
    <div class="container-fluid">

      <div class="card">
        <div class="card-header">
          <b>Remplir feuille de temps</b>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label>Projets / Activités</label>
                <div name="ListProjet" id="ListProjet"></div>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label>Date début</label>
                <input type="text" class="form-control" id="Done">
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label>Date Fin</label>
                <input type="text" class="form-control" id="DoneFin">
              </div>
            </div>
              <div class="col">
                <div class="form-group">
                  <label>Jour</label>
                  <br>
                  <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <label class="btn btn-info active">
                      <input type="radio" name="options" value="0.25" id="options" autocomplete="off" checked>0,25
                    </label>
                    <label class="btn btn-info">
                      <input type="radio" name="options" value="0.5" id="options" autocomplete="off">0,5
                    </label>
                    <label class="btn btn-info">
                      <input type="radio" name="options" value="0.75" id="options" autocomplete="off">0,75
                    </label>
                    <label class="btn btn-info">
                      <input type="radio" name="options" value="1" id="options" autocomplete="off">1
                    </label>
                  </div>
                </div>
              </div>
              
              <div class="col">
                  <div class="form-group">
                    <label>Valider</label>
                    <button type="button" id="SetFicheDeTemps" class="btn btn-success btn-block">Envoyer</button>
                  </div>
                </div>
          </div>
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-lg-6">
          <div id="TableTotAujourdhui"></div>
        </div>
        <div class="col-lg-6">
          <div id="TableTotJoursNonPlein"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {

      //Date d'aujourd'hui
      $('#Done, #DoneFin').val(ChoixDate(0));
      $('#Done, #DoneFin').datetimepicker({format: 'dd-mm-yyyy', autoclose: true, minView: 2 , weekStart: 1});

      //Charger liste projets
      RequeteAjax('ListProjet', 'ListeDeroulanteProjet', 'Modele/RequetesAjax.php');
      SetSelect2('#projetId');

      //Charger liste
      ChargerListeHeures1Jour1Ressource()

      TableTotJoursNonPlein()

      //Si ne reconnait pas l'utilisateur, le rediriger vers la connexion
      if (!localStorage.getItem("Connexion")) {
        $('.container-fluid').html("<h1>Erreur de cache</h1>Je ne reconnais pas qui tu es. Peut-tu te connecter à nouveau en cliquand <a href='Modele/ConnectionLogout.php'>ICI</a> ?")
      }

      $('#Done').change(function () {
        ChargerListeHeures1Jour1Ressource()
        $('#DoneFin').val($('#Done').val())
      });

      //Add les infos
      $('#SetFicheDeTemps').click(function () {

        console.log(ListeJoursDate($('#Done').val(), $('#DoneFin').val()))

          $.ajax({
            url: "Modele/FicheDeTemps.php",
            method: "POST",
            data: {
              action: "Create",
              Ressource: localStorage.getItem("Connexion"),
              Projet: $('#projetId').val(),
              Time: $("input[name=options]:checked").val(),
              Done: ListeJoursDate($('#Done').val(), $('#DoneFin').val()),
              Log: DateFrToEn(ChoixDate(0))
            },
            success: function (data) {
              BootstrapAlertDefaut(data);
              ChargerListeHeures1Jour1Ressource()
              TableTotJoursNonPlein()
            }
          });
      });

      //Charger les infos
      function ChargerListeHeures1Jour1Ressource() {

        var LaDate = DateFrToEn($('#Done').val())

        if ($('#Done').val() == "") 
          LaDate = DateFrToEn(ChoixDate(0))

        $.ajax({
          url: "Modele/FicheDeTemps.php",
          method: "POST",
          data: {
            action: "LoadHeuresRempli1Jour1Ressource",
            Done: LaDate,
            LaRessource: localStorage.getItem("Connexion")
          },
          success: function (data) {
            $('#TableTotAujourdhui').html(data);
          }
        });
      }

      //Supprimer une fiche de temps
      $(document).on('click', '.delete', function () {
        if (confirm("Es-tu sûr de vouloir supprimer cette donnée ?")) 
          $.ajax({
            url: "Modele/FicheDeTemps.php",
            method: "POST",
            data: {
              id: $(this).attr("id"),
              action: "Delete"
            },
            success: function (data) {
              ChargerListeHeures1Jour1Ressource()
              TableTotJoursNonPlein()
              BootstrapAlertDefaut(data);
            }
          })
      });

      //?
      function TableTotJoursNonPlein() {
        $.ajax({
          url: "Modele/FicheDeTemps.php",
          method: "POST",
          data: {
            LaRessource: localStorage.getItem("Connexion"),
            action: "TableTotJoursNonPlein"
          },
          success: function (data) {
            $('#TableTotJoursNonPlein').html(data);
          }
        })
      }

    });
  </script>