<body class="fixed-nav sticky-footer" id="page-top">
  <div class="content-wrapper">
    <div class="container">

      <div class="mb-5">
        <div class="form-row">
          <div class="col-md-9">
            <button type="button" id="modal_button" class="btn btn-info">Créer un projet</button>
            <button type="button" name="add" id="add" class="btn btn-info">Ajouter une image</button>
          </div>
        </div>

        <input class="form-control" id="BarreDeRecherche" type="text" placeholder="Rechercher..">

        <div id="result" class="table-responsive table-hover">

        </div>
      </div>
    </div>
  </body>

  <div id="customerModal" class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title"></h4>
        </div>
        <div class="modal-body">

          <div class="form-group">
            <label>Nom</label>
            <input class="form-control" name="Nom" id="Nom" type="text" placeholder="Nom..">
          </div>

          <div class="form-group">
            <label>Type</label>
            <div id="listeTypeProjet"></div>
          </div>

          <div class="form-group">
            <label>Icone (50x50)</label>
            <div id='ListImage'></div>
            <br>
            <img id="IconPreview" src='Assets/Image/Projets/inconnue.png' width="53px">
          </div>

        </div>
        <div class="modal-footer">
          <input type="hidden" name="id" id="id" />
          <input type="submit" name="action" id="action" class="btn btn-success" />
          <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>


<div id="imageModal" class="modal fade" role="dialog">
 <div class="modal-dialog">
  <div class="modal-content">
   <div class="modal-header"><h4>Ajouter une image</h4></div>
   <div class="modal-body">
    <form id="image_form" method="post" enctype="multipart/form-data">
     <input type="file" name="image" id="image" /></p><br />
     <input type="hidden" name="action" id="action" value="insert" />
     <input type="hidden" name="image_id" id="image_id" />
     <input type="submit" name="insert" id="insert" value="Insert" class="btn btn-info" />
      
    </form>
   </div>
   <div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
   </div>
  </div>
 </div>
</div>

  <script>

    $(document).ready(function () {

      BarreDeRecherche('BarreDeRecherche', 'result');

      RemplirListTypeTypeProjet('listeTypeProjet')

      RemplirListImages('ListImage');

      fetchUser();

      function fetchUser() {
        var action = "Load";
        $.ajax({
          url: "Modele/ActionGestionProjet.php",
          method: "POST",
          data: { action: action },
          success: function (data) {
            $('#result').html(data);
          }
        });
      }

      function RemplirListImages(Div) {
        var action = "LoadPictures";
        $.ajax({
          url: "Modele/ActionGestionProjet.php",
          method: "POST",
          data: { action: action },
          success: function (data) {
            $('#' + Div + '').html(data);
          }
        });

      }

      $('#ListImage').change(function () {
        $("#IconPreview").attr("src", 'Assets/Image/Projets/' + $('#ToutesLesImages').val());
      });

      $('#modal_button').click(function () {
        $('#customerModal').modal('show');
        $('.modal-title').text("Ajouter un projet");
        $('#action').val('Ajouter');
        $('#Nom').val('');
      });

      $('#action').click(function () {

        var Nom = $('#Nom').val();
        var TypeProjet = $('#TypeProjet').val();
        var fileName = $('#ToutesLesImages').val();
        var action = $('#action').val();
        var id = $('#id').val();

        if (Nom != '' && TypeProjet != '' && fileName != '') {
          $.ajax({
            url: "Modele/ActionGestionProjet.php",
            method: "POST",
            data: { id: id, Nom: Nom, TypeProjet: TypeProjet, fileName: fileName, action: action },

            success: function (data) {
              BootstrapAlert(data);
              console.log(data);
              $('#customerModal').modal('hide');
              fetchUser();
            }
          });
        }
        else {
          alert("Tous les champs doivent être plein.");
        }
      })



      $(document).on('click', '.update', function () {
        var id = $(this).attr("id");
        var action = "Select";
        $.ajax({
          url: "Modele/ActionGestionProjet.php",
          method: "POST",
          data: { id: id, action: action },
          dataType: "json",
          success: function (data) {
            $('#customerModal').modal('show');
            $('.modal-title').text("Mettre à jour");
            $('#action').val("Update");

            $('#id').val(id);
            $('#Nom').val(data.Nom);
            $('#TypeProjet').val(data.TypeProjet);
            $('#ToutesLesImages').val(data.Logo);
            $('#IconPreview').attr('src', 'Assets/Image/Projets/' + data.Logo);
          }
        });
      });

      $(document).on('click', '.delete', function () {
        var id = $(this).attr("id");
        if (confirm("Es-tu sûr de vouloir supprimer cet(te) employé(e) ?")) {
          var action = "Delete";
          $.ajax({
            url: "Modele/ActionGestionProjet.php",
            method: "POST",
            data: { id: id, action: action },
            success: function (data) {
              fetchUser();
              BootstrapAlert(data);
            }
          })
        }
        else {
          return false;
        }
      });

 $('#add').click(function(){
  $('#imageModal').modal('show');
  $('#image_form')[0].reset();
  $('.modal-title').text("Add Image");
  $('#image_id').val('');
  $('#action').val('insert');
  $('#insert').val("Insert");
 });
 $('#image_form').submit(function(event){
  event.preventDefault();
  var image_name = $('#image').val();
  if(image_name == '')
  {
   alert("Please Select Image");
   return false;
  }
  else
  {
   var extension = $('#image').val().split('.').pop().toLowerCase();
   if(jQuery.inArray(extension, ['gif','png','jpg','jpeg']) == -1)
   {
    alert("Invalid Image File");
    $('#image').val('');
    return false;
   }
   else
   {
    $.ajax({
     url:"Modele/ActionGestionProjet.php",
     method:"POST",
     data:new FormData(this),
     contentType:false,
     processData:false,
     success:function(data)
     {
      $('#image_form')[0].reset();
      $('#imageModal').modal('hide');
      BootstrapAlert(data);
      fetchUser();

     }
    });
   }
  }
 });

    });
  </script>