<body class="fixed-nav sticky-footer" id="page-top">
  <div class="content-wrapper">
    <div class="container-fluid">

<div class="row">
      <div class="col-lg-3">
        <div class="card">
          <h5 class="card-header">Couleur cartes</h5>
          <div class="card-body">
            <input type="color" class="" id="CouleurUser">
            <P></P>
            <div class="card BOUGEMOI" style=" border-left: 5px solid;">
            <div style="margin-left:4px;"><b>
              Prenom Nom | Projet <img class="LogoProjet" src="Assets/Image/Projets/' . $row["Path"] . '"></b><br>
              Texte de la tache
            </div>
            </div>
          </div>
        </div>
      </div>
<p></p>
<div class="col-lg-3">
        <div class="card">
            <h5 class="card-header">Mot de passe</h5>
            <div class="card-body">
                <div class="form-group">
                    <label>Ancien mot de passe</label>
                    <input type="password" class="form-control" id="ancienmdp" minlength="5" required="required">
                  </div>
                  <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" class="form-control" id="mdp" minlength="5" required="required">
                  </div>
                  <div class="form-group">
                    <label>Confirmez le mot de passe</label>
                    <input type="password" class="form-control" id="confirmmdp" minlength="5" required="required">
                  </div>
            
                  <button class="btn btn-primary" id="SetMdp">Sauvegarder</button>
            </div>
          </div>
        </div>
        <div class="col-lg-3">
            <div class="card">
                <h5 class="card-header">Total des tâches validées</h5>
                <div class="card-body">
                    <div id="TacheValide"></div>
                </div>
              </div>
            </div>
            <div class="col-lg-3">
                <div class="card">
                    <h5 class="card-header">Total des fiches de temps</h5>
                    <div class="card-body">
                        <div id="FicheValide"></div>
                    </div>
                  </div>
                </div>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {

      $.ajax({
        url: "Modele/Parametre.php",
        method: "POST",
        data: {
          action: "LoadTacheValide",
          idRessource: localStorage.getItem('Connexion')
        },
        success: function (data) {
          $('#TacheValide').html(data);
        }
      });

      $.ajax({
        url: "Modele/Parametre.php",
        method: "POST",
        data: {
          action: "LoadFicheDeTempsValide",
          idRessource: localStorage.getItem('Connexion')
        },
        success: function (data) {
          $('#FicheValide').html(data);
        }
      });

      $.ajax({
        url: "Modele/Parametre.php",
        method: "POST",
        data: {
          action: "Load",
          idRessource: localStorage.getItem('Connexion')
        },
        success: function (data) {
          $('#CouleurUser').val(data.split(' ')[4]);
          $("#AfficherCouleur").css("background-color", $('#CouleurUser').val());
        }
      });

      $('#CouleurUser').change(function () {

        $('.BOUGEMOI').css('border-left','5px solid '+$('#CouleurUser').val())
        $.ajax({
          url: "Modele/Parametre.php",
          method: "POST",
          data: {
            action: "CustomColorName",
            couleur: $('#CouleurUser').val(),
            idRessource: localStorage.getItem('Connexion')
          },
          success: function (data) {
            BootstrapAlertDefaut(data);
          }
        });

      })

      $('#SetMdp').click(function () {

        $.ajax({
          url: "Modele/GestionTache.php",
          method: "POST",
          data: {
            ancienmdp: $('#ancienmdp').val(),
            idRessource: localStorage.getItem('Connexion'),
            action: "Checkpswd"
          },
          success: function (ancienmdpOk) {
            if ($('#mdp').val() != $('#confirmmdp').val()) {
              BootstrapAlertError('Les mots de passe ne correspondent pas.')
            } else if ($('#mdp').val().length < 5) {
              BootstrapAlertError('Un mot de passe est composé de 5 caractères minimuim')
            } else if (ancienmdpOk.trim() == "non") {
              BootstrapAlertError('Ton ancien mot de passe n\'est pas le même que celui que je connais..')
            } else {
              $.ajax({
                url: "Modele/Parametre.php",
                method: "POST",
                data: {
                  action: "Update",
                  idRessource: localStorage.getItem('Connexion'),
                  mdp: $('#mdp').val()
                },
                success: function (data) {
                  BootstrapAlertDefaut(data);
                }
              });
            }
          }
        });
      });

    });
  </script>