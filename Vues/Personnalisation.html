<body class="fixed-nav sticky-footer" id="page-top">
  <div class="content-wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-4">
          <div class="card">
            <h5 class="card-header">Couleur cartes</h5>
            <div class="card-body">
              <input type="color" class="" id="CouleurUser">
              <p></p>
              <div class="card BOUGEMOI" style=" border-left: 5px solid;">
                <div style="margin-left:4px;">
                  <b>
                    Prenom Nom | Projet
                    <img class="LogoProjet" src="Assets/Image/Projets/Inconnue.png"></b><br>
                  Texte de la tache
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card">
            <h5 class="card-header">Mot de passe</h5>
            <div class="card-body">
              <div class="form-group">
                <label>Ancien mot de passe</label>
                <input type="password" class="form-control" id="ancienmdp" minlength="5" required="required">
              </div>
              <div class="form-group">
                <label>Nouveau mot de passe</label>
                <input type="password" class="form-control" id="mdp" minlength="5" required="required">
              </div>
              <div class="form-group">
                <label>Confirmez le mot de passe</label>
                <input type="password" class="form-control" id="confirmmdp" minlength="5" required="required">
              </div>
              <button class="btn btn-primary" id="SetMdp">Sauvegarder</button>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card">
            <h5 class="card-header">Total des tâches validées</h5>
            <div class="card-body">
              <div id="TacheValide"></div>
            </div>
          </div>
        </div>
      </div>
      <h2>Infos fiches de temps</h2>
      <hr>
      <p></p>
      <div class="row">
        <div class="col-lg-4">
          <div class="card">
            <h5 class="card-header">Fiches de temps / Sprint</h5>
            <div class="card-body">
              <div id="ListSrint"></div>
              <div id="TotRempliSprint"></div>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card">
            <h5 class="card-header">Fiches de temps / Mois</h5>
            <div class="card-body">
              <div class="form-row">
                <div class="col">
                  <select id="LeMois" class="form-control">
                    <option value="01" selected="selected">Janvier</option>
                    <option value="02">Février</option>
                    <option value="03">Mars</option>
                    <option value="04">Avril</option>
                    <option value="05">Mai</option>
                    <option value="06">Juin</option>
                    <option value="07">Juillet</option>
                    <option value="08">Août</option>
                    <option value="09">Septembre</option>
                    <option value="10">Octobre</option>
                    <option value="11">Novembre</option>
                    <option value="12">Décembre</option>
                  </select>
                </div>
                <div class="col">
                  <select id="LeAnnee" class="form-control">
                    <option value="2019">2019</option>
                    <option value="2020">2020</option>
                  </select>
                </div>
              </div>
              <div id="TotRempliDate"></div>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card">
            <h5 class="card-header">Fiches de temps / Total</h5>
            <div class="card-body">
              <div id="FicheValide"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {

      //List de sprint chargé
      RequeteAjax('ListSrint', 'ListeDeroulanteSprint', 'Modele/RequetesAjax.php');

      //Selectionner le mois actuel
      LeMois = (new Date).getMonth()+1
      if(LeMois < 10)
        LeMois = '0'+LeMois 
      $('#LeMois option[value="' + LeMois + '"]').attr('selected', 'selected')

      //Charge liste heures fiche de temps sur un sprint au lancement de la page
      ListTotalSurSprint()
      ListTotalFdTSurMois();

      //Load total taches validées
      $.ajax({
        url: "Modele/Parametre.php",
        method: "POST",
        data: {
          action: "LoadTacheValide",
          idRessource: localStorage.getItem('Connexion')
        },
        success: function (data) {
          $('#TacheValide').html(data);
        }
      });

      //Load total fiche de temps validé
      $.ajax({
        url: "Modele/Parametre.php",
        method: "POST",
        data: {
          action: "LoadFicheDeTempsValide",
          idRessource: localStorage.getItem('Connexion')
        },
        success: function (data) {
          $('#FicheValide').html(data);
        }
      });

      $.ajax({
        url: "Modele/Parametre.php",
        method: "POST",
        data: {
          action: "Load",
          idRessource: localStorage.getItem('Connexion')
        },
        success: function (data) {
          $('#CouleurUser').val(data.split(' ')[4]);
          $("#AfficherCouleur").css("background-color", $('#CouleurUser').val());
        }
      });

      //Quand change sprint, charge list de temps
      $('#ListSrint').change(function () {
        ListTotalSurSprint()
      });

      //Quand change sprint, charge list de temps
      $('#LeMois,#LeAnnee').change(function () {
        ListTotalFdTSurMois();
      });

      function ListTotalFdTSurMois() {
        $.ajax({
          url: "Modele/FicheDeTemps.php",
          method: "POST",
          data: {
            LaRessource: localStorage.getItem("Connexion"),
            LeMois: $("#LeMois option:selected").val(),
            LeAnnee: $("#LeAnnee option:selected").val(),
            action: "ListTotalSurDate"
          },
          success: function (data) {
            $('#TotRempliDate').html(data);
          }
        })
      }

      function ListTotalSurSprint() {
        $.ajax({
          url: "Modele/FicheDeTemps.php",
          method: "POST",
          data: {
            LaRessource: localStorage.getItem("Connexion"),
            LeSprint: $("#numeroSprint").val(),
            action: "ListTotalSurSprint"
          },
          success: function (data) {
            $('#TotRempliSprint').html(data);
          }
        })
      }

      //Quand change la couleur pour les taches
      $('#CouleurUser').change(function () {

        $('.BOUGEMOI').css('border-left', '5px solid ' + $('#CouleurUser').val())
        $.ajax({
          url: "Modele/Parametre.php",
          method: "POST",
          data: {
            action: "CustomColorName",
            couleur: $('#CouleurUser').val(),
            idRessource: localStorage.getItem('Connexion')
          },
          success: function (data) {
            BootstrapAlertDefaut(data);
          }
        });

      })

      //Quand cliccjk pour set le mdp
      $('#SetMdp').click(function () {

        $.ajax({
          url: "Modele/GestionTache.php",
          method: "POST",
          data: {
            ancienmdp: $('#ancienmdp').val(),
            idRessource: localStorage.getItem('Connexion'),
            action: "Checkpswd"
          },
          success: function (ancienmdpOk) {
            if ($('#mdp').val() != $('#confirmmdp').val()) {
              BootstrapAlertError('Les mots de passe ne correspondent pas.')
            } else if ($('#mdp').val().length < 5) {
              BootstrapAlertError('Un mot de passe est composé de 5 caractères minimuim')
            } else if (ancienmdpOk.trim() == "non") {
              BootstrapAlertError('Ton ancien mot de passe n\'est pas le même que celui que je connais..')
            } else {
              $.ajax({
                url: "Modele/Parametre.php",
                method: "POST",
                data: {
                  action: "Update",
                  idRessource: localStorage.getItem('Connexion'),
                  mdp: $('#mdp').val()
                },
                success: function (data) {
                  BootstrapAlertDefaut(data);
                }
              });
            }
          }
        });
      });

    });
  </script>
