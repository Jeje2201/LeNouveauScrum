<body class="fixed-nav sticky-footer" id="page-top">
  <div class="content-wrapper projets">
    <div class="container-fluid">

      <div class="row">
        <div class="col-lg-3 align-middle">
          <button class="btn btn-primary back">
            <i class="fa fa-chevron-left pr-2"></i>
            Retour à la liste des projets
          </button>
        </div>
        <div class="col-lg-6">
          <div class="mb-3">
            <h2 class="text-center mb-2" id="NomProjet"></h2>
            <h4 class="text-center mb-4" id="ClientEntreprise"></h4>
            <h4 class="text-center mb-3" id="DescriptionProjet"></h4>
          </div>
        </div>
        <div class="col-lg-3 text-center my-auto">
          <img src="Assets/Image/Autre/Client_Info.png" class="img-fluid pointer" style="height: 100px;" onclick="$('#ModaleClient').modal('show');">
        </div>
      </div>

      <div class="row">
        <div class="col-lg-3">
          <div class="frame mb-3">
            <span class="mt-1"><small>Niveau de facturation</small></span>
            <button class="btn btn-sm ml-2 mb-2 btn-add" id="ModaleBudgeButton">
              <i class="fa fa-plus-circle"></i>
            </button>
            <div id="PieChartArgent" class="col row m-0"></div>
            <p class="text-center mb-n1">Total</p>
            <h3 class="text-center" id="MontantBudgetBottom"></h3>
          </div>
          </div>
          <div class="col-lg-6">
            <div class="frame mb-3">
              <p class="mt-1">
                <small>Ressoures mobilisées</small>
                <button class="btn btn-sm ml-2 mb-2 btn-add" onclick="$('#ModaleAddUser').modal('show'); " >
                  <i class="fa fa-plus-circle"></i>
                </button>
              </p>
              <div id="RessourcesMobilisees" class="col row"></div>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="border mb-3 DisableEffect">
              <!-- <div id="datetimepicker12"></div> -->
            </div>
            
          </div>
      </div>
      
      <div class="row">
      <div class="col">
        <div class="frame mb-3">
        <p class="mt-1">
          <small>Échange réalisés</small>
          <button class="btn btn-sm ml-2 mb-2 btn-add" id="ModaleAddEchange">
            <i class="fa fa-plus-circle"></i>
          </button>
        </p>
        
          <table class="table table-sm table-striped table-bordered">
            <thead>
              <tr>
                <th>Échange</th>
                <th>Date</th>
                <th>Type</th>
                <th>Édition</th>
              </tr>
            </thead>
            <tbody id="EchangesProjet">
              
            </tbody>
          </table>
            
      </div>
    </div>
      <div class="col">
        <div class="frame mb-3">
          <p class="mt-1">
            <small>Technologies mobilisées</small>
            <button class="btn btn-sm ml-2 mb-2 btn-add" onclick="ShowAndClearModaleForNew('ModaleTechno')">
              <i class="fa fa-plus-circle"></i>
            </button>
          </p>
          <div id="TechnologiesProjet" class="col row"></div>
        </div>
      </div>
    </div>
      

      <div class="frame mb-3">
        <p class=""><small>Note</small></p>
        <div class="col p-0">
          <textarea class="form-control mb-2" id="Note" rows="3"></textarea>
          <button  class="btn btn-success" id="putNote" data-dismiss="modal">Valider</button>
        </div>
      </div>

      <div class="frame mb-3">
        <span class="mt-1"><small>Timeline</small></span>
        <button class="btn btn-sm ml-2 mb-2 btn-add" id="ModaleTimeLineButton">
          <i class="fa fa-plus-circle"></i>
        </button>
        <div id="ProjectTimeLine" class="col row"></div>
      </div>

    </div>
  </div>

<div id="ModaleClient" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">

      </div>
      <div class="modal-footer">
        <input class="form-control" id="ClientID" type="text" readonly>
        <button  class="btn btn-dark" data-dismiss="modal">Fermer</button>
      </div>
    </div>
  </div>
</div>

<div id="ModaleBudget" class="modal fade">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body mb-2">

        <div id="ListBudgetConnu"></div>

      <div class="form-row">
        <div class="form-group col-8">
          <input type="text" class="form-control" id="Add_Label_Budget" placeholder="Label">
        </div>
        <div class="form-group col-2">
          <input type="number" class="form-control" id="Add_Montant_Budget" >
        </div>
        <div class="form-group col-2">
          <button  id="InsertBudget" class="btn btn-success"><i class="fa fa-plus" aria-hidden="true"></i></button>
        </div>
      </div>
      <button  class="btn btn-dark" data-dismiss="modal">Fermer</button>

      </div>

    </div>
  </div>
</div>

<div id="ModaleTimeLine" class="modal fade">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body mb-2">

        <div id="TimeLineConnu"></div>

      <div class="form-row">
        <div class="form-group col-6">
          <input type="text" class="form-control" id="Add_Label_TimeLine" placeholder="Label">
        </div>
        <div class="form-group col-2">
          <input type="text" class="form-control" id="Add_Debut_TimeLine" placeholder="Début">
        </div>
        <div class="form-group col-2">
          <input type="text" class="form-control" id="Add_Fin_TimeLine" placeholder="Fin">
        </div>
        <div class="form-group col-2">
          <button  id="InsertTimeLine" class="btn btn-success"><i class="fa fa-plus" aria-hidden="true"></i></button>
        </div>
      </div>

      <button  class="btn btn-dark" data-dismiss="modal">Fermer</button>

      </div>

    </div>
  </div>
</div>

<div id="ModaleAddUser" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <p>Ressources</p>

        <select class="form-control" id="ListeRessource">
        </select>
        <button  id="AddRessourceToProject" class="btn btn-info mt-2 btn-sm">Ajouter ressource(s)</button>
      </div>

    </div>
  </div>
</div>

<div id="ModaleTechno" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <p>Technologie</p>

        <input class="form-control" list="listTechnos" id="inputTechno"/>

        <datalist id="listTechnos">
            <option value="Ajax">
            <option value="Jquery">
            <option value="PHP">
            <option value="HTML">
            <option value="VueJs">
        </datalist>

        <button  id="AddTechnoToProject" class="btn btn-success mt-3 btn-sm">Ajouter Techno</button>
      </div>

    </div>
  </div>
</div>

<div id="ModaleComment" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <div class="col">

        <div class="form-group">
          <label>Échange</label>
          <textarea class="form-control" id="Echange_Label"
              rows="3"></textarea>

        </div>
        </div>

        <div class="col">
          <div class="form-group">
            <label>Date</label>
            <input type="text" class="form-control" id="Echange_Date">
          </div>
        </div>

        <div class="col">
          <div class="form-group">
            <label>Type</label>

            <input class="form-control" list="listEchangeType" id="Echange_Type"/>

            <datalist id="listEchangeType">
                <option value="Mail">
                <option value="Téléphone">
                <option value="Réunion">
                <option value="Entretiens">
            </datalist>

          </div>
        </div>
        <input type="number" class="form-control d-none" id="Echange_ID">

        <div class="col">
          <button  id="AddEchange" class="btn btn-success mt-2 btn-block">Nouvel échange</button>
          <button  id="EditEchange" class="btn btn-warning mt-2 btn-block">Éditer échange</button>
        </div>

      </div>

    </div>
  </div>
</div>

<script>
  $(document).ready(function () {

    FillEmptySelect('ListeRessource','GetUsers','Modele/User.php','LaListeDesUsers')

    $('#Echange_Date, #Add_Debut_TimeLine, #Add_Fin_TimeLine').datetimepicker({format: 'dd/mm/yyyy', autoclose: true, minView: 2, weekStart: 1});

    var projectId = parseInt(location.href.split('projet=')[1])
    
    GetDescription()
    GetClient()
    GetRessourcesMobilisees()
    GetTechnos()
    GetNote()
    GetEchanges()
    GetTimeLine()
    LoadBudgetsChart()

    $('#datetimepicker12').datetimepicker({
                inline: true,
                sideBySide: true
            });

    $('.back').bind( "click", function() {
      window.location.href = location.origin+location.pathname+'?vue=Gestion_Projet';
    });

    //+-+-+-+-+-+-+-+-+-+-+ Infos Piechart Argent +-+-+-+-+-+-+-+-+-+-+

    $('#ModaleBudgeButton').bind( "click", function() {
      $('#ModaleBudget').modal('show')
      LoadListBudget()
    })

    $('#InsertBudget').bind( "click", function() {

      $.ajax({
            url: "Modele/ProjectInformation.php",
            method: "POST",
            data: {
              projet_budget_fk_projet: projectId,
              projet_budget_montant: $("#Add_Montant_Budget").val(),
              projet_budget_label: $("#Add_Label_Budget").val(),
              action: "Create_Projet_Budget"
            },
            dataType: "json",
            success: function (data) {
              Notify(data,'yes','non')
              $("#Add_Montant_Budget, #Add_Label_Budget").val('')
              LoadListBudget()
              LoadBudgetsChart()
            }
        })

    })

    function LoadListBudget(){
      $('#ListBudgetConnu').html('')

      $.ajax({
      url: "Modele/ProjectInformation.php",
      method: "POST",
      data: {
        projectId: projectId,
        action: "getBudgets"
      },
      dataType: "json",
      success: function (data) {

        $.each(data, function () {

        $('#ListBudgetConnu').append(`
        <div class="form-row">
          <div class="form-group col-8">
            <input id="Label_Budget_`+this.projet_budget_pk+`" class="form-control" type="text" value="`+this.projet_budget_label+`"/>
          </div>
          <div class="form-group col-2">
            <input id="Montant_Budget_`+this.projet_budget_pk+`" class="form-control" type="number" value="`+this.projet_budget_montant+`"/>
          </div>
          <div class="form-group col-2">
            <button  id="Update_Budgete_`+this.projet_budget_pk+`" class="btn btn-warning UpdateBudget"><i class="fa fa-pencil" aria-hidden="true"></i></button>
            <button  id="Delete_Budgete_`+this.projet_budget_pk+`" class="btn btn-danger DeleteBudget"><i class="fa fa-trash" aria-hidden="true"></i></button>
          </div>
        </div>`)
        })

        $('.UpdateBudget').bind( "click", function() {

          $.ajax({
            url: "Modele/ProjectInformation.php",
            method: "POST",
            data: {
              projet_budget_fk_projet: projectId,
              projet_budget_montant: $("#Montant_Budget_"+this.id.split('_')[2]).val(),
              projet_budget_label: $("#Label_Budget_"+this.id.split('_')[2]).val(),
              projet_budget_pk: parseInt(this.id.split('_')[2]),
              action: "Update_Projet_Budget"
            },
            dataType: "json",
            success: function (data) {
              Notify(data,'yes','non')
              LoadBudgetsChart()
            }
          })

        })

        $('.DeleteBudget').bind( "click", function() {
          
          $.ajax({
            url: "Modele/ProjectInformation.php",
            method: "POST",
            data: {
              projet_budget_pk: parseInt(this.id.split('_')[2]),
              action: "Delete_Projet_Budget"
            },
            dataType: "json",
            success: function (data) {
              Notify(data,'yes','non')
              LoadListBudget()
              LoadBudgetsChart()
            }
          })

        })
        
      }
    });
  }

    function LoadBudgetsChart(){
    $.ajax({
      url: "Modele/ProjectInformation.php",
      method: "POST",
      data: {
        projectId: projectId,
        action: "getBudgets"
      },
      dataType: "json",
      success: function (data) {

       

        data = data.map(function(obj) { 
                obj['name'] = obj['projet_budget_label']; // Assign new key 
                obj['y'] = parseInt(obj['projet_budget_montant']); // Assign new key 
                return obj; 
        });

       var total_budget = 0;
       $.each(data, function () {
        total_budget += this.y
       })

       $('#MontantBudgetBottom').text(total_budget + '€ HT')

        chart = new Highcharts.Chart({
        chart: {
            renderTo: 'PieChartArgent',
            height: 200,
            type: 'pie'
        },
        title: {
            text: ''
        },
        tooltip: {
            formatter: function() {
                return '<b>'+ this.point.name +'</b>: '+ this.y +' €';
            }
        },
        series: [{
            data: data,
            innerSize: '40%',
        }]
    });
      }
    });
    }

    //+-+-+-+-+-+-+-+-+-+-+ Infos Projet +-+-+-+-+-+-+-+-+-+-+

    function GetDescription(){
    $.ajax({
      url: "Modele/Projet.php",
      method: "POST",
      data: {
        id: projectId,
        action: "Select"
      },
      dataType: "json",
      success: function (data) {
        $('#NomProjet').text(data.projet_nom);
        if(data.projet_description == null){
          data.projet_description = "Description manquante"
        }
        $('#DescriptionProjet').text(data.projet_description);
      }
    });
    }

    //+-+-+-+-+-+-+-+-+-+-+ Client +-+-+-+-+-+-+-+-+-+-+

    function GetClient(){
    $.ajax({
      url: "Modele/ProjectInformation.php",
      method: "POST",
      dataType: "json",
      data: {
        projectId: projectId,
        action: "getClient"
      },
      success: function (data) {

        $('#ModaleClient .modal-body').append('<h1>Client</h1>');
        $('#ModaleClient .modal-body').append('<p><b>Entreprise: </b>'+data.client_entreprise+'</p>');
        $('#ModaleClient .modal-body').append('<p><b>Client: </b>'+data.client_prenom+' '+data.client_nom+'</p>');
        $('#ModaleClient .modal-body').append('<p><b>Job: </b>'+data.client_job+'</p>');
        $('#ModaleClient .modal-body').append('<p><b>Mail: </b>'+data.client_mail+'</p>');
        $('#ModaleClient .modal-body').append('<p><b>Téléphone: </b>'+data.client_telephone+'</p>');

        $('#ClientID').val(data.client_pk);

      },
          error: function (xhr, status, erreur) {
            $.notify(erreur, "error");
          }
    });
  }

  //+-+-+-+-+-+-+-+-+-+-+ Ressources +-+-+-+-+-+-+-+-+-+-+

    function GetRessourcesMobilisees() {

    $('#RessourcesMobilisees').html('')

    $.ajax({
      url: "Modele/ProjectInformation.php",
      method: "POST",
      data: {
        projectId: projectId,
        action: "GetRessources"
      },
      dataType: "json",
      success: function (data) {

        $.each(data, function () {

          var divRessource = $(`<div class="col"></div>`);

          if(this.Avatar == '' || this.Avatar == undefined || this.Avatar == null){ 
            this.Avatar = 'default.png'
          }

          divRessource.append($(`<img height="75px" width="75px" src="Assets/Image/Ressources/`+this.Avatar+`">`));
          divRessource.append($(`<img class="pointer" id="`+this.RessourceId+`" height="25px" width="25px" style="position: absolute;left: 74px;top: 1px;" src="` + `Assets/Image/Autre/delete.png">`).bind( "click", function() {
            SuppRessource($(this))
          }));

          divRessource.append($(`<p class="mb-n1"><b>`+this.Prenom+`</b></p>`))
          divRessource.append($(`<small>`+this.Job+`</small>`))
          
          $('#RessourcesMobilisees').append(divRessource)
        
        })
      }
    })
  }

    $('#AddRessourceToProject').bind( "click", function() { 
        $.ajax({
          url: "Modele/ProjectInformation.php",
          method: "POST",
          data: {
            projectId: projectId,
            UserId: $('#ListeRessource').val(),
            action: "AddRessource"
          },
          success: function (data) {
            $.notify(data, "success");
            GetRessourcesMobilisees();
            $('#ListeRessource').val('').select2()
          },
          error: function (xhr,status,erreur){
            $.notify(erreur, "error");
          }
        });

     });

    function SuppRessource(infos) {

      var idRessource = infos[0].id.split('_')[1]
      var RessourceNom = infos[0].nextSibling.textContent

      if (confirm("Es-tu sûr de vouloir supprimer "+RessourceNom+" ?"))

          $.ajax({
            url: "Modele/ProjectInformation.php",
            method: "POST",
            data: {
              idRessource: idRessource,
              action: "DellRessourceProjet"
            },
            success: function (data) {
              Notify(data,'Ressource '+RessourceNom+' supprimée')
              GetRessourcesMobilisees();
            }
          });
      
    }

    //+-+-+-+-+-+-+-+-+-+-+ Infos Note +-+-+-+-+-+-+-+-+-+-+

    function GetNote(){
    $.ajax({
      url: "Modele/Projet.php",
      method: "POST",
      data: {
        id: projectId,
        action: "Select"
      },
      dataType: "json",
      success: function (data) {
        $('#Note').text(data.projet_note);
      }
    });
    }

    $('#putNote').bind( "click", function() {

      $.ajax({
          url: "Modele/ProjectInformation.php",
          method: "POST",
          data: {
            Note_Text: $('#Note').val(),
            projectId: projectId,
            action: "putNote"
          },
          success: function (data) {
            Notify(data,'Note éditée')
          }
        });
    })

    //+-+-+-+-+-+-+-+-+-+-+ Technos +-+-+-+-+-+-+-+-+-+-+

    function GetTechnos() {
      $('#TechnologiesProjet').html('')

      $.ajax({
        url: "Modele/ProjectInformation.php",
        method: "POST",
        data: {
          projectId: projectId,
          action: "GetTechnos"
        },
        dataType: "json",
        success: function (data) {

          $.each(data, function () {

            var divTechnologie = $(`<div class="col"></div>`);

            divTechnologie.append($(`<img class="" height="75px" width="75px" src="` + `Assets/Image/Autre/Logo_Code.png">`))
            divTechnologie.append($(`<img class="pointer" id="`+this.technologieId+`" height="25px" width="25px" style="position: absolute;left: 69px;top: -5px;" src="` + `Assets/Image/Autre/delete.png">`).bind( "click", function() {
              SuppTechno($(this))
          }));

            divTechnologie.append($(`<p>`+this.technologie+`</p>`))

            $('#TechnologiesProjet').append(divTechnologie)
          })

        }
      });
    }
    
    $('#AddTechnoToProject').bind( "click", function() {
      
      var NouvelleTechno = $('#inputTechno').val()

      if (NouvelleTechno != undefined && NouvelleTechno != '' && NouvelleTechno != null) {
        $.ajax({
          url: "Modele/ProjectInformation.php",
          method: "POST",
          data: {
            projectId: projectId,
            NouvelleTechno: NouvelleTechno,
            action: "AddTechno"
          },
          success: function (data) {
            Notify(data,'Technologie '+NouvelleTechno+' ajoutée')
            GetTechnos();
            $('#inputTechno').val('')
          }
        });
      }
      else {
        $.notify("Il faut du texte pour la techno.", "error");
      }
    })

    function SuppTechno(infos) {

      var idTechno = infos[0].id.split('_')[1]
      var nomTechno = infos[0].nextSibling.textContent

      if (confirm("Es-tu sûr de vouloir supprimer '"+nomTechno+"' ?"))
        $.ajax({
          url: "Modele/ProjectInformation.php",
          method: "POST",
          data: {
            idTechno: idTechno,
            NomTechno: nomTechno,
            action: "DellTechno"
          },
          success: function (data) {
            Notify(data,'Technologie '+nomTechno+' supprimée')
            GetTechnos();
          }
        });
    }

    //+-+-+-+-+-+-+-+-+-+-+ Echange +-+-+-+-+-+-+-+-+-+-+
    
    $('#ModaleAddEchange').bind( "click", function() {
      ShowAndClearModaleForNew('ModaleComment','EditEchange','AddEchange')
      $('#Echange_Date').val(CustomYourDate(ChoixDate(0),'dd/mm/yyyy'));
      $('#Echange_Label').val('');
    });

    $(document).on('click', '.updateEchange', function () {

      $('#AddEchange').hide()
      $('#EditEchange').show()

      $.ajax({
        url: "Modele/ProjectInformation.php",
        method: "POST",
        data: {
          idComment: this.id,
          action: "getEchange"
        },
        dataType: "json",
        success: function (data) {
          $('#ModaleComment').modal('show');

          $('#Echange_Label').val(data.resume_echange);
          $('#Echange_Date').val(data.date_echange);
          $('#Echange_Type').val(data.type_echange);

          $('#Echange_ID').val(data.id_echange);
        }
      });

      })

    function GetEchanges(){
    
    $('#EchangesProjet').html('')
    
    $.ajax({
      url: "Modele/ProjectInformation.php",
      method: "POST",
      data: {
        projectId: projectId,
        action: "getEchanges"
      },
      dataType: "json",
      success: function (data) {

      $.each(data, function () {
        $('#EchangesProjet').prepend(`<tr>
                <td>`+this.resume_echange+`</td>
                <td>`+this.date_echange+`</td>
                <td>`+this.type_echange+`</td>
                <td>
                  <div class="btn-group d-flex" role="group">
                    <button id="` + this.id_echange + `" class="btn btn-warning btn-sm updateEchange"><i class="fa fa-pencil" aria-hidden="true"></i></button>
                    <button id="` + this.id_echange + `" class="btn btn-danger btn-sm deleteEchange"><i class="fa fa-trash" aria-hidden="true"></i></button>
                  </div>
                </td>
              </tr>`);
      })
      IfNoRows('EchangesProjet','Aucun échange trouvé..')
      }
    });
    
    }

    $('#AddEchange').bind( "click", function() { 

      $.ajax({
          url: "Modele/ProjectInformation.php",
          method: "POST",
          data: {
            projectId: projectId,
            echange_label: document.getElementById('Echange_Label').value,
            echange_date: CustomYourDate($('#Echange_Date').val()),
            echange_type: $("#Echange_Type").val(),
            action: "postEchange"
          },
          success: function (data) {
            Notify(data,'Echange '+document.getElementById('Echange_Label').value+' ajouté')
            GetEchanges();
          }
        });

    });

    $('#EditEchange').bind( "click", function() {

      $.ajax({
          url: "Modele/ProjectInformation.php",
          method: "POST",
          data: {
            echange_id: document.getElementById('Echange_ID').value,
            echange_label: document.getElementById('Echange_Label').value,
            echange_date: CustomYourDate($('#Echange_Date').val()),
            echange_type: $("#Echange_Type").val(),
            action: "putEchange"
          },
          success: function (data) {
            Notify(data,'Echange '+document.getElementById('Echange_Label').value+' modifié')
            GetEchanges();
          }
        });

      $('#ModaleComment').modal('hide');

     });

     $(document).on('click', '.deleteEchange', function () {

      if (confirm("Es-tu sûr de vouloir supprimer cet échange ?"))
        $.ajax({
          url: "Modele/ProjectInformation.php",
          method: "POST",
          data: {
            projectId: projectId,
            idEchange: this.id,
            action: "DellEchange"
          },
          success: function (data) {
            Notify(data,'Echange bien supprimé')
            GetEchanges();
          }
        });
    });
  
    //+-+-+-+-+-+-+-+-+-+-+ Timeline +-+-+-+-+-+-+-+-+-+-+

    $('#ModaleTimeLineButton').bind( "click", function() {
      $('#ModaleTimeLine').modal('show')
      LoadListTimeLine()
    })

      function LoadListTimeLine(){
      $('#TimeLineConnu').html('')

      $.ajax({
      url: "Modele/ProjectInformation.php",
      method: "POST",
      data: {
        projectId: projectId,
        action: "getTimeLines"
      },
      dataType: "json",
      success: function (data) {

        $.each(data, function () {

        $('#TimeLineConnu').append(`
        <div class="form-row">
          <div class="form-group col-6">
            <input id="Label_Timeline_`+this.projet_timeline_pk+`" class="form-control" type="text" value="`+this.projet_timeline_label+`"/>
          </div>
          <div class="form-group col-2">
            <input id="projet_timeline_debut_`+this.projet_timeline_pk+`" class="form-control projet_timeline_debut" type="text" value="`+CustomYourDate(this.projet_timeline_debut,'dd/mm/yyyy')+`"/>
          </div>
          <div class="form-group col-2">
            <input id="projet_timeline_fin_`+this.projet_timeline_pk+`" class="form-control projet_timeline_fin" type="text" value="`+CustomYourDate(this.projet_timeline_fin,'dd/mm/yyyy')+`"/>
          </div>
          <div class="form-group col-2">
            <button  id="Update_Timeline_`+this.projet_timeline_pk+`" class="btn btn-warning UpdateTimeline"><i class="fa fa-pencil" aria-hidden="true"></i></button>
            <button  id="Delete_Timeline_`+this.projet_timeline_pk+`" class="btn btn-danger DeleteTimeline"><i class="fa fa-trash" aria-hidden="true"></i></button>
          </div>
        </div>`)
        })

        $('.UpdateTimeline').bind( "click", function() {

          $.ajax({
            url: "Modele/ProjectInformation.php",
            method: "POST",
            data: {
              projet_timeline_fk_projet: projectId,
              projet_timeline_label: $("#Label_Timeline_"+this.id.split('_')[2]).val(),
              projet_timeline_debut: CustomYourDate($("#projet_timeline_debut_"+this.id.split('_')[2]).val()),
              projet_timeline_fin: CustomYourDate($("#projet_timeline_fin_"+this.id.split('_')[2]).val()),
              projet_timeline_pk: parseInt(this.id.split('_')[2]),
              action: "Update_Projet_Timeline"
            },
            dataType: "json",
            success: function (data) {
              $.notify("succes", "success");
              GetTimeLine()
            },
          error: function (xhr,status,erreur){
            $.notify(erreur, "error");
          }
          })

        })

        $('.DeleteTimeline').bind( "click", function() {
          
          $.ajax({
            url: "Modele/ProjectInformation.php",
            method: "POST",
            data: {
              projet_timeline_pk: parseInt(this.id.split('_')[2]),
              action: "Delete_Projet_Timeline"
            },
            dataType: "json",
            success: function (data) {
              $.notify("succes", "success");
              LoadListTimeLine()
              GetTimeLine()
            },
          error: function (xhr,status,erreur){
            $.notify(erreur, "error");
          }
          })

        })
        
      }
    });
  }

  $('#InsertTimeLine').bind( "click", function() {

    $.ajax({
      url: "Modele/ProjectInformation.php",
      method: "POST",
      data: {
        projet_timeline_fk_projet: projectId,
        projet_timeline_label: $("#Add_Label_TimeLine").val(),
        projet_timeline_debut: CustomYourDate($("#Add_Debut_TimeLine").val()),
        projet_timeline_fin: CustomYourDate($("#Add_Fin_TimeLine").val()),
        action: "Create_Projet_Timeline"
      },
      dataType: "json",
      success: function (data) {
        $.notify("Nouvelle time line ajoutée", "success");
        $("#Add_Label_timeline, #Add_Debut_TimeLine, #Add_Fin_TimeLine").val('')
        LoadListTimeLine()
        GetTimeLine()
      },
      error: function (xhr,status,erreur){
        $.notify(erreur, "error");
      }
    })

  })

    function GetTimeLine(){

      $.ajax({
        url: "Modele/ProjectInformation.php",
        method: "POST",
        data: {
          projectId: projectId,
          action: "getTimeLines"
        },
        dataType: "json",
        success: function (data) {

          var TotalDates = new Array

          $.each(data, function () {

            var LaDate = ['Projet',this.projet_timeline_label, new Date(this.projet_timeline_debut), new Date(this.projet_timeline_fin)]

            TotalDates.push(LaDate)
          })

          google.charts.load("current", {packages:["timeline"]});
          google.charts.setOnLoadCallback(drawChart);
          function drawChart() {

          var container = document.getElementById('ProjectTimeLine');
          var chart = new google.visualization.Timeline(container);
          var dataTable = new google.visualization.DataTable();
          dataTable.addColumn({ type: 'string', id: 'vide' });
          dataTable.addColumn({ type: 'string', id: 'Name' });
          dataTable.addColumn({ type: 'date', id: 'Start' });
          dataTable.addColumn({ type: 'date', id: 'End' });
          dataTable.addRows(TotalDates);

          var options = {
          };

          if(data.length == 0){
            document.getElementById('ProjectTimeLine').innerHTML= '<div>Timeline vide</div>'
          }
          else{
            chart.draw(dataTable, options);
          }
        }
        }
      })

      
    }
  
  })
</script>